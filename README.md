
# ğŸ›¡ï¸ Transparent Pipeline Relay v2.1

> **Stateless Â· Raw Â· Device-Sync Relay Server**
> íŒë‹¨í•˜ì§€ ì•ŠëŠ” ì„œë²„, ì „ë‹¬ë§Œ í•˜ëŠ” íŒŒì´í”„ë¼ì¸

---

## 1. ê°œìš” (Overview)

**Transparent Pipeline Relay**ëŠ”
DB ì—†ì´ ë™ì‘í•˜ëŠ” **ì™„ì „ ì¸ë©”ëª¨ë¦¬ ì‹¤ì‹œê°„ ì¤‘ê³„ ì„œë²„**ì…ë‹ˆë‹¤.

ì„œë²„ëŠ” ë©”ì‹œì§€ë¥¼ **í•´ì„Â·ë³€í˜•Â·ì €ì¥í•˜ì§€ ì•Šê³ **,
í´ë¼ì´ì–¸íŠ¸ ê°„ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ì „ë‹¬í•˜ëŠ” **íˆ¬ëª…í•œ í„°ë„** ì—­í• ë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤.

### í•µì‹¬ ì² í•™

* âŒ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì—†ìŒ
* âŒ ë°ì´í„°ë² ì´ìŠ¤ ì—†ìŒ
* âŒ ì˜ì† ì €ì¥ ì—†ìŒ
* âœ… Raw ë°ì´í„° ê·¸ëŒ€ë¡œ ì „ë‹¬
* âœ… ì˜¤í”„ë¼ì¸ ì‹œ ì„ì‹œ íì‰
* âœ… ë””ë°”ì´ìŠ¤ ê°„ ì¦‰ì‹œ ë™ê¸°í™”

---

## 2. ì£¼ìš” ê¸°ëŠ¥ (Features)

* **Master / Slave êµ¬ì¡°**

  * ëª¨ë°”ì¼ = Master
  * PC / ê¸°íƒ€ ê¸°ê¸° = Slave
* **ì—°ë™ ì½”ë“œ ê¸°ë°˜ ë””ë°”ì´ìŠ¤ ì—°ê²°**
* **Raw Relay**

  * JSON / Text / Binary ëª¨ë‘ í†µê³¼
* **ì˜¤í”„ë¼ì¸ ë©”ì‹œì§€ í**

  * ìµœëŒ€ 30ë¶„ ë³´ê´€
  * ì¬ì ‘ì† ì¦‰ì‹œ ìë™ ì „ë‹¬
* **Echo Sync**

  * ë™ì¼ ê³„ì •ì˜ ë‹¤ë¥¸ ê¸°ê¸°ì— ìë™ ë°˜ì˜
* **ì™„ì „ Stateless (RAM Only)**

---

## 3. ì•„í‚¤í…ì²˜ ê°œë…

```
[ Device A ] â”€â”
               â”œâ”€â”€ Transparent Relay Server â”€â”€â”
[ Device B ] â”€â”˜                                â”œâ”€> [ Device C ]
                                                â””â”€> [ Device D ]
```

ì„œë²„ëŠ” **ì¤‘ê³„ë§Œ** í•˜ë©°,
ë©”ì‹œì§€ì˜ ì˜ë¯¸Â·íƒ€ì…Â·ì²˜ë¦¬ëŠ” ëª¨ë‘ í´ë¼ì´ì–¸íŠ¸ ì±…ì„ì…ë‹ˆë‹¤.

---

## 4. ë°ì´í„° êµ¬ì¡°

### Groups

```js
hardwareId -> {
  master: socketId,
  slaves: Set<socketId>,
  syncCode,
  expires
}
```

### Socket Mapping

```js
socketId -> hardwareId
```

### Sync Codes

```js
code -> hardwareId
```

### Offline Queue

```js
hardwareId -> [{ payload, expiresAt }]
```

---

## 5. ì´ë²¤íŠ¸ íë¦„ (Event Flow)

### â‘  Master ë“±ë¡

```js
register_master(hardwareId)
```

* ë””ë°”ì´ìŠ¤ ê·¸ë£¹ ìƒì„±
* ê¸°ì¡´ í ìë™ ìˆ˜ì‹ 

---

### â‘¡ ì—°ë™ ì½”ë“œ ìš”ì²­

```js
request_sync_code
```

* 6ìë¦¬ HEX ì½”ë“œ ë°œê¸‰
* ìœ íš¨ ì‹œê°„: 5ë¶„

---

### â‘¢ Slave ì—°ê²°

```js
link_pc(code)
```

* ì½”ë“œ ê²€ì¦ í›„ ë™ì¼ ê·¸ë£¹ í¸ì…
* í ìë™ í”ŒëŸ¬ì‹œ

---

### â‘£ Raw ë°ì´í„° ì¤‘ê³„

```js
raw_relay({ toId, data })
```

**ì²˜ë¦¬ ë¡œì§**

1. í˜ì´ë¡œë“œ í¬ê¸° ê²€ì‚¬ (ìµœëŒ€ 5MB)
2. ì‹¤ì‹œê°„ ì „ë‹¬ ì‹œë„
3. ì‹¤íŒ¨ ì‹œ ì˜¤í”„ë¼ì¸ í ì €ì¥
4. ì†¡ì‹ ìì—ê²Œ ìƒíƒœ ë°˜í™˜
5. ë™ì¼ ê³„ì • ê¸°ê¸°ë¡œ Echo ì „íŒŒ

---

## 6. ì˜¤í”„ë¼ì¸ í (Tunnel Queue)

| í•­ëª©    | ê°’          |
| ----- | ---------- |
| ë³´ê´€ ì‹œê°„ | 30ë¶„        |
| ìµœëŒ€ ê°œìˆ˜ | 100ê°œ / ì‚¬ìš©ì |
| ì €ì¥ ë°©ì‹ | ë©”ëª¨ë¦¬ (RAM)  |
| ì „ë‹¬ ì‹œì  | ì¬ì ‘ì† ì¦‰ì‹œ     |

---

## 7. ì„¤ì • ê°’

```js
MAX_PAYLOAD_SIZE = 5MB
QUEUE_TTL        = 30 minutes
MAX_QUEUE_SIZE   = 100
SYNC_CODE_TTL    = 5 minutes
CLEANUP_INTERVAL = 1 minute
```

---

## 8. Legacy ì§€ì›

ê¸°ì¡´ í…ŒìŠ¤íŠ¸ìš© HTMLì„ ìœ„í•œ ì´ë²¤íŠ¸ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.

```js
direct_message
push
mark_as_read
```

> ì‹ ê·œ í”„ë¡œì íŠ¸ì—ì„œëŠ” `raw_relay` ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.

---

## 9. ë³´ì•ˆ ë° í•œê³„ (Important)

âš ï¸ **í”„ë¡œë•ì…˜ ì‚¬ìš© ì‹œ ì£¼ì˜**

* ì„œë²„ ì¬ì‹œì‘ ì‹œ ëª¨ë“  ë°ì´í„° ì†Œë©¸
* ë©€í‹° ì¸ìŠ¤í„´ìŠ¤ ë¯¸ì§€ì›
* ì¸ì¦ / ê¶Œí•œ ê²€ì¦ ì—†ìŒ
* DDoS ë°©ì–´ ì—†ìŒ

ğŸ‘‰ ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì•„ë˜ ì¶”ê°€ ê¶Œì¥:

* Redis (í & ë¸Œë¡œë“œìºìŠ¤íŠ¸)
* JWT / Device Auth
* Rate Limit
* HTTPS + Reverse Proxy

---

## 10. ì‹¤í–‰ ë°©ë²•

```bash
npm install
node server.js
```

ê¸°ë³¸ í¬íŠ¸: `3000`

í—¬ìŠ¤ ì²´í¬:

```
GET /ping â†’ pong
```

---

## 11. ì‚¬ìš© ì‚¬ë¡€

* ëª¨ë°”ì¼ â†” PC ì‹¤ì‹œê°„ ë™ê¸°í™”
* ë””ë°”ì´ìŠ¤ ê°„ ë©”ì‹œì§€ ë¸Œë¦¬ì§€
* P2P ì‹œê·¸ë„ ì„œë²„
* ì‹¤í—˜ìš© ë©”ì‹ ì € ë°±ì—”ë“œ
* IoT ì œì–´ ì¤‘ê³„ ì„œë²„

---

## 12. ì² í•™ (Philosophy)

> **â€œì„œë²„ëŠ” íŒë‹¨í•˜ì§€ ì•ŠëŠ”ë‹¤.â€**
> **â€œí´ë¼ì´ì–¸íŠ¸ê°€ ëª¨ë“  ì˜ë¯¸ë¥¼ ê°€ì§„ë‹¤.â€**

Transparent Pipelineì€
**ìµœì†Œ ê°œì… Â· ìµœëŒ€ ììœ **ë¥¼ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.

---
